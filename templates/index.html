{% extends 'layout.html' %} 
{% block title %}游侠车迷社区{% endblock %}
{% block stylesheet %} {% endblock %} {% block main %}
<main class="App-content">
  <div id="content" style="padding-bottom: 0px;">
    <div class="IndexPage">
      <div></div>
      <div class="container">
        <nav class="IndexPage-nav sideNav">
          <ul>
            <li class="item-newDiscussion App-primaryControl">
              <button class="Button Button--primary IndexPage-newDiscussion hasIcon" itemclassname="App-primaryControl" type="button" title="发布帖子"> <i class="icon fa fa-fw fa-edit Button-icon"></i>
                <span class="Button-label">发布帖子</span>
              </button>
            </li>
            <li class="item-nav">
              <div class="ButtonGroup Dropdown dropdown App-titleControl Dropdown--select itemCount16">
                <button class="Dropdown-toggle Button" data-toggle="dropdown">
                  <span class="Button-label">All Discussions</span> <i class="icon fa fa-fw fa-sort Button-caret"></i>
                </button>
                <ul class="Dropdown-menu dropdown-menu ">
                  <li class="item-allDiscussions active">
                    <a href="/" active="true" class=" hasIcon" type="button" title="所有帖子">
                      <i class="icon fa fa-fw fa-comments-o Button-icon"></i>
                      <span class="Button-label">所有帖子</span>
                    </a>
                  </li>
                  <li class="item-following">
                    <a href="/following" active="false" class=" hasIcon" type="button" title="关注">
                      <i class="icon fa fa-fw fa-star Button-icon"></i>
                      <span class="Button-label">关注</span>
                    </a>
                  </li>
                  <li class="item-tags">
                    <a href="/tags" active="false" class=" hasIcon" type="button" title="标签">
                      <i class="icon fa fa-fw fa-th-large Button-icon"></i>
                      <span class="Button-label">标签</span>
                    </a>
                  </li>
                  <li class="Dropdown-separator"></li>
                  <li class="item-tag20">
                    <a class="TagLinkButton hasIcon " href="/t/post-tests-here" style="" title="Test out Flarum in this tag. Discussions in this tag will be deleted every so often.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(181, 158, 140);"></span>
                      Post tests here
                    </a>
                  </li>
                  <li class="item-tag24">
                    <a class="TagLinkButton hasIcon " href="/t/support" style="" title="Get help setting up, using, and customising Flarum.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(75, 147, 209);"></span>
                      Support
                    </a>
                  </li>
                  <li class="item-tag69">
                    <a class="TagLinkButton hasIcon " href="/t/feedback" style="" title="For discussing Flarum core features and design. For issues use Support.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(147, 84, 202);"></span>
                      Feedback
                    </a>
                  </li>
                  <li class="item-tag48">
                    <a class="TagLinkButton hasIcon " href="/t/extensions" style="" title="Announce your extensions and provide help to users in this area. For requests/ideas, post in Feedback. For help building extensions, post in Dev >
                      Extensibility.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(72, 191, 131);"></span>
                      Extensions
                    </a>
                  </li>
                  <li class="item-tag4">
                    <a class="TagLinkButton hasIcon " href="/t/dev" style="" title="For developers. Get help hacking core, building extensions, themes, and translations.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(65, 65, 65);"></span>
                      Dev
                    </a>
                  </li>
                  <li class="item-tag16">
                    <a class="TagLinkButton hasIcon " href="/t/meta" style="" title="Discussion about this community: its organisation and how we can improve it.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(239, 86, 79);"></span>
                      Meta
                    </a>
                  </li>
                  <li class="item-tag52">
                    <a class="TagLinkButton hasIcon " href="/t/resources" style="" title="Share Flarum-related resources and services here: hosting, jobs, etc.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(98, 108, 120);"></span>
                      Resources
                    </a>
                  </li>
                  <li class="item-tag1">
                    <a class="TagLinkButton hasIcon " href="/t/off-topic" style="" title="Off-topic discussions that don't fit into any other categories.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(214, 139, 79);"></span>
                      Off-topic
                    </a>
                  </li>
                  <li class="item-tag60">
                    <a class="TagLinkButton hasIcon " href="/t/solved" style="" title="Solved issues.">
                      <span class="icon TagIcon Button-icon" style="background-color: rgb(109, 187, 62);"></span>
                      Solved
                    </a>
                  </li>
                  <li class="item-tag19">
                    <a class="TagLinkButton hasIcon " href="/t/performance" style="" title="">
                      <span class="icon TagIcon Button-icon"></span>
                      Performance
                    </a>
                  </li>
                  <li class="item-tag57">
                    <a class="TagLinkButton hasIcon " href="/t/integrations" style="" title="Extensions for other software, like browsers or wordpress.">
                      <span class="icon TagIcon Button-icon"></span>
                      Integrations
                    </a>
                  </li>
                  <li class="item-moreTags">
                    <a href="/tags" active="false" class="" type="button" title="More...">
                      <span class="Button-label">More...</span>
                    </a>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </nav>
        <div class="IndexPage-results sideNavOffset">
          <div class="IndexPage-toolbar">
            <ul class="IndexPage-toolbar-view">
              <li class="item-sort">
                <span class="Select">
                  <select class="Select-input FormControl">
                    <option value="latest">最新回复</option>
                    <option value="top">最热帖子</option>
                    <option value="newest">最新帖子</option>
                    <option value="oldest">最早帖子</option>
                  </select>
                  <i class="icon fa fa-fw fa-sort Select-caret"></i>
                </span>
              </li>
            </ul>
            <ul class="IndexPage-toolbar-action">
              <li class="item-markAllAsRead">
                <button title="全部标记为已读" class="Button Button--icon hasIcon" type="button">
                  <i class="icon fa fa-fw fa-check Button-icon"></i>
                </button>
              </li>
            </ul>
          </div>
          <div class="DiscussionList">
            <ul class="DiscussionList-discussions">
              {%for post in all_posts.list%}
              <li data-id="3852">
                <div class="DiscussionListItem">
                  <a class="Slidable-underneath Slidable-underneath--left Slidable-underneath--elastic">
                    <i class="icon fa fa-fw fa-check "></i>
                  </a>
                  <div class="DiscussionListItem-content Slidable-content unread">
                    <a href="/user/weazy" class="DiscussionListItem-author" title="" data-original-title="weazy started 13 minutes ago">
                      {%if post.author_avatar%}
                      <img class="Avatar " src="{{post.author_avatar}}"></a>
                    {%else%}
                    <span class="Avatar " style="background: rgb(208, 160, 229);">{{post.author_username|format_username}}</span>
                    {%endif%}
                    <ul class="DiscussionListItem-badges badges"></ul>
                    <a href="/post/{{post.post_id}}" class="DiscussionListItem-main">
                      <span class="DiscussionListItem-title">{{post.title}}</span>
                      <ul class="DiscussionListItem-info">
                        <li class="item-tags">
                          <span class="TagsLabel ">
                            <span class="TagLabel  colored" style="color: #999; background-color: #f5f5f5;">
                              <span class="TagLabel-text">君越2016款</span>
                            </span>
                          </span>
                        </li>
                        <li class="item-terminalPost">
                          <span>
                            <i class="icon fa fa-fw fa-reply "></i>
                            <span class="username">Marek</span>
                            最后回复于
                            <time pubdate="true" datetime="2016-09-30T14:27:27+08:00" title="Friday, September 30, 2016 2:27 PM" data-humantime="true">11 分钟前</time>
                          </span>
                        </li>
                      </ul>
                    </a>
                    <span class="DiscussionListItem-count" title="设为已读">{{post.reply_num}}</span>
                  </div>
                </div>
              </li>
              {%endfor%}
            </ul>
            <div class="DiscussionList-loadMore" data-pages="{{all_posts.page.pages}}" data-current="{{all_posts.page.current}}" data-next="{{all_posts.page.next}}">
              <button class="Button" type="button" title="加载更多">
                <span class="Button-label">加载更多</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="flarum-loading" style="display: none;">Loading...</div>
  <div class="App-composer">
    <div class="container">
      <div id="composer">
        <div class="Composer" style="display: none; bottom: 0px; height: 300px;">
          <div class="Composer-handle" style="cursor: row-resize;"></div>
          <ul class="Composer-controls">
            <li class="item-minimize App-backControl">
              <button title="Minimize" itemclassname="App-backControl" class="Button Button--icon Button--link hasIcon" type="button">
                <i class="icon fa fa-fw fa-minus minimize Button-icon"></i>
              </button>
            </li>
            <li class="item-fullScreen">
              <button title="Full Screen" class="Button Button--icon Button--link hasIcon" type="button">
                <i class="icon fa fa-fw fa-expand Button-icon"></i>
              </button>
            </li>
            <li class="item-close">
              <button title="Close" class="Button Button--icon Button--link hasIcon" type="button">
                <i class="icon fa fa-fw fa-times Button-icon"></i>
              </button>
            </li>
          </ul>
          <div class="Composer-content">
            <div class="ComposerBody ComposerBody--discussion">
              <span class="Avatar ComposerBody-avatar" style="background: rgb(160, 176, 229);">G</span>
              <div class="ComposerBody-content">
                <ul class="ComposerBody-header">
                  <li class="item-title">
                    <h3>Start a Discussion</h3>
                  </li>
                  <li class="item-tags">
                    <a class="DiscussionComposer-changeTags">
                      <span class="TagLabel untagged">选择标签</span>
                    </a>
                  </li>
                  <li class="item-tags">
                    <a class="DiscussionComposer-changeTags">
                      <span class="TagLabel untagged">选择品牌车型</span>
                    </a>
                  </li>
                  <li class="item-discussionTitle">
                    <h3>
                      <input class="FormControl" placeholder="帖子标题"></h3>
                  </li>
                </ul>
                <div class="ComposerBody-editor">
                  <div class="TextEditor">
                    <div class="ComposerBody-emojiWrapper">
                      <div class="ComposerBody-mentionsWrapper">
                        <textarea class="FormControl Composer-flexible" placeholder="正文写在这里..." style="height: 189px;"></textarea>
                        <div class="ComposerBody-mentionsDropdownContainer"></div>
                      </div>
                      <div class="ComposerBody-emojiDropdownContainer"></div>
                    </div>
                    <ul class="TextEditor-controls Composer-footer">
                      <li class="item-submit App-primaryControl">
                        <button class="Button Button--primary hasIcon" itemclassname="App-primaryControl" type="button" title="Post Discussion">
                          <i class="icon fa fa-fw fa-check Button-icon"></i>
                          <span class="Button-label">发布帖子</span>
                        </button>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="LoadingIndicator ComposerBody-loading">
                <div class="spinner" role="progressbar" style="position: absolute; width: 0px; z-index: auto; left: 50%; top: 50%;">
                  <div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-0-8 1s linear infinite;">
                    <div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(0deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div>
                  </div>
                  <div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-1-8 1s linear infinite;">
                    <div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(45deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div>
                  </div>
                  <div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-2-8 1s linear infinite;">
                    <div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(90deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div>
                  </div>
                  <div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-3-8 1s linear infinite;">
                    <div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(135deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div>
                  </div>
                  <div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-4-8 1s linear infinite;">
                    <div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(180deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div>
                  </div>
                  <div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-5-8 1s linear infinite;">
                    <div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(225deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div>
                  </div>
                  <div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-6-8 1s linear infinite;">
                    <div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(270deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div>
                  </div>
                  <div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-7-8 1s linear infinite;">
                    <div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(315deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div>
                  </div>
                </div>
                &nbsp;
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %} {% block modal %}
<div id="modal">
  <div class="ModalManager modal fade" style="display:none;"></div>
</div>
{% endblock %} {% block javascript %}
<script type="text/javascript">
$(document).ready(function() {
    $(document).on('click', '.DiscussionComposer-changeTags', function() {
        var modal = '<div class="Modal modal-dialog TagDiscussionModal"><div class="Modal-content"><div class="Modal-close App-backControl"><button class="Button Button--icon Button--link hasIcon" type="button"><i class="icon fa fa-fw fa-times Button-icon"></i></button></div><form><div class="Modal-header"><h3 class="App-titleControl App-titleControl--text">Choose Tags for Your Discussion</h3></div><div class="Modal-alert"></div><div class="Modal-body"><div class="TagDiscussionModal-form"><div class="TagDiscussionModal-form-input"><div class="TagsInput FormControl "><span class="TagsInput-selected"></span><input class="FormControl" placeholder="Choose a primary tag"></div></div><div class="TagDiscussionModal-form-submit App-primaryControl"><button type="submit" class="Button Button--primary hasIcon disabled" disabled="" title="OK"><i class="icon fa fa-fw fa-check Button-icon"></i><span class="Button-label">OK</span></button></div></div></div><div class="Modal-footer"><ul class="TagDiscussionModal-list SelectTagList"><li data-index="20" class="pinned colored active" style="color: rgb(181, 158, 140);"><span class="icon TagIcon " style="background-color: rgb(181, 158, 140);"></span><span class="SelectTagListItem-name">Post tests here</span><span class="SelectTagListItem-description">Test out Flarum in this tag. Discussions in this tag will be deleted every so often.</span></li><li data-index="24" class="pinned colored" style="color: rgb(75, 147, 209);"><span class="icon TagIcon " style="background-color: rgb(75, 147, 209);"></span><span class="SelectTagListItem-name">Support</span><span class="SelectTagListItem-description">Get help setting up, using, and customising Flarum.</span></li><li data-index="69" class="pinned colored" style="color: rgb(147, 84, 202);"><span class="icon TagIcon " style="background-color: rgb(147, 84, 202);"></span><span class="SelectTagListItem-name">Feedback</span><span class="SelectTagListItem-description">For discussing Flarum core features and design. For issues use Support.</span></li><li data-index="48" class="pinned colored" style="color: rgb(72, 191, 131);"><span class="icon TagIcon " style="background-color: rgb(72, 191, 131);"></span><span class="SelectTagListItem-name">Extensions</span><span class="SelectTagListItem-description">Announce your extensions and provide help to users in this area. For requests/ideas, post in Feedback. For help building extensions, post in Dev &gt; Extensibility.</span></li><li data-index="4" class="pinned colored" style="color: rgb(65, 65, 65);"><span class="icon TagIcon " style="background-color: rgb(65, 65, 65);"></span><span class="SelectTagListItem-name">Dev</span><span class="SelectTagListItem-description">For developers. Get help hacking core, building extensions, themes, and translations.</span></li><li data-index="16" class="pinned colored" style="color: rgb(239, 86, 79);"><span class="icon TagIcon " style="background-color: rgb(239, 86, 79);"></span><span class="SelectTagListItem-name">Meta</span><span class="SelectTagListItem-description">Discussion about this community: its organisation and how we can improve it.</span></li><li data-index="52" class="pinned colored" style="color: rgb(98, 108, 120);"><span class="icon TagIcon " style="background-color: rgb(98, 108, 120);"></span><span class="SelectTagListItem-name">Resources</span><span class="SelectTagListItem-description">Share Flarum-related resources and services here: hosting, jobs, etc.</span></li><li data-index="1" class="pinned colored" style="color: rgb(214, 139, 79);"><span class="icon TagIcon " style="background-color: rgb(214, 139, 79);"></span><span class="SelectTagListItem-name">Off-topic</span><span class="SelectTagListItem-description">Off-topic discussions that dont fit into any other categories.</span></li><li data-index="60" class="colored" style="color: rgb(109, 187, 62);"><span class="icon TagIcon " style="background-color: rgb(109, 187, 62);"></span><span class="SelectTagListItem-name">Solved</span><span class="SelectTagListItem-description">Solved issues.</span></li><li data-index="19" class=""><span class="icon TagIcon "></span><span class="SelectTagListItem-name">Performance</span></li><li data-index="57" class=""><span class="icon TagIcon "></span><span class="SelectTagListItem-name">Integrations</span><span class="SelectTagListItem-description">Extensions for other software, like browsers or wordpress.</span></li><li data-index="70" class=""><span class="icon TagIcon "></span><span class="SelectTagListItem-name">Duplicate</span></li><li data-index="73" class=""><span class="icon TagIcon "></span><span class="SelectTagListItem-name">Reported</span></li><li data-index="45" class=""><span class="icon TagIcon "></span><span class="SelectTagListItem-name">Security</span></li><li data-index="71" class=""><span class="icon TagIcon "></span><span class="SelectTagListItem-name">Document</span></li></ul></div></form></div></div>';
        $('.ModalManager').html(modal);
        $('.modal').modal('show');
    });

    $(document).on('click', '.item-newDiscussion', function() {
        $('.Composer').addClass('normal');
        $('.Composer').addClass('active');
        $('.Composer').addClass('visible');
        $('.Composer').css("display", "block");
    });

    $(document).on('click', '.item-submit', function() {
        var title = $('.item-discussionTitle input').val();
        var content = $('.ComposerBody-editor textarea').val();
        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            url: "/new",
            data: JSON.stringify({
                title: title,
                content: content,
            }),
            success: function(msg) {
                if (msg.success == 0) {
                    window.location.replace(msg.redirect);
                }
            },
            error: function(msg) {
                alert("error");
            }
        });
    });

    $(document).on('click', '.DiscussionList-loadMore', function() {
      var pages = $(this).attr('data-pages');
      var current = $(this).attr('data-current');
      var next = $(this).attr('data-next');

      if (current == pages) {
        return;
      }
      $.getJSON('/api/get/posts?page=' + next, function(data) {
        alert(data.page.current);
      });
    });
});
</script>
{% endblock %}