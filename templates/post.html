{% extends 'layout.html' %}

{% block stylesheet %}
{% endblock %} 

{% block main %}
<main class="App-content">
        <div id="content" style="padding-bottom: 0px;">
          <div class="DiscussionPage">
            <div class="DiscussionPage-discussion">
              <div class="container">
                <nav class="DiscussionPage-nav">
                  <ul>
                    <li class="item-controls">
                      <div class="ButtonGroup Dropdown dropdown App-primaryControl Dropdown--split itemCount1">
                        <button class=" SplitDropdown-button Button Button--primary hasIcon" type="button" title="回复">
                          <i class="icon fa fa-fw fa-reply Button-icon"></i>
                          <span class="Button-label">回复</span></button>
                        <button class="Dropdown-toggle Button Button--icon Button--primary" data-toggle="dropdown">
                          <i class="icon fa fa-fw fa-ellipsis-v Button-icon"></i>
                          <i class="icon fa fa-fw fa-caret-down Button-caret"></i>
                        </button>
                        <ul class="Dropdown-menu dropdown-menu  Dropdown-menu--right">
                          <li class="item-reply">
                            <button class=" hasIcon" type="button" title="回复">
                              <i class="icon fa fa-fw fa-reply Button-icon"></i>
                              <span class="Button-label">回复</span></button>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="item-subscription">
                      <div class="Dropdown ButtonGroup SubscriptionMenu">
                        <button class="Button SubscriptionMenu-button SubscriptionMenu-button--false hasIcon" title="" type="button" data-original-title="Get an email when there are new posts">
                          <i class="icon fa fa-fw fa-star-o Button-icon"></i>
                          <span class="Button-label">关注</span></button>
                        <button class="Dropdown-toggle Button Button--icon SubscriptionMenu-button--false" data-toggle="dropdown">
                          <i class="icon fa fa-fw fa-caret-down Button-icon"></i>
                        </button>
                        <ul class="Dropdown-menu dropdown-menu Dropdown-menu--right">
                          <li>
                            <button class="SubscriptionMenuItem hasIcon">
                              <i class="icon fa fa-fw fa-check Button-icon"></i>
                              <span class="SubscriptionMenuItem-label">
                                <i class="icon fa fa-fw fa-star-o Button-icon"></i>
                                <strong>取消关注</strong>
                                <span class="SubscriptionMenuItem-description">仅在有人@提到我时提醒我.</span></span>
                            </button>
                          </li>
                          <li>
                            <button class="SubscriptionMenuItem hasIcon">
                              <span class="SubscriptionMenuItem-label">
                                <i class="icon fa fa-fw fa-star Button-icon"></i>
                                <strong>正在关注</strong>
                                <span class="SubscriptionMenuItem-description">当有人回复此帖子时提醒我.</span></span>
                            </button>
                          </li>
                          <li>
                            <button class="SubscriptionMenuItem hasIcon">
                              <span class="SubscriptionMenuItem-label">
                                <i class="icon fa fa-fw fa-eye-slash Button-icon"></i>
                                <strong>忽略</strong>
                                <span class="SubscriptionMenuItem-description">不接收任何提醒并隐藏此帖子.</span></span>
                            </button>
                          </li>
                        </ul>
                      </div>
                    </li>
                    <li class="item-scrubber">
                      <div class="PostStreamScrubber Dropdown App-titleControl">
                        <button class="Button Dropdown-toggle" data-toggle="dropdown">
                          <span class="Scrubber-index">1</span>of
                          <span class="Scrubber-count">10</span>posts
                          <i class="icon fa fa-fw fa-sort "></i></button>
                        <div class="Dropdown-menu dropdown-menu">
                          <div class="Scrubber">
                            <a class="Scrubber-first">
                              <i class="icon fa fa-fw fa-angle-double-up "></i>最先发布</a>
                            <div class="Scrubber-scrollbar" style="max-height: 489px; cursor: pointer; -webkit-user-select: none;">
                              <div class="Scrubber-before" style="height: 0%;"></div>
                              <div class="Scrubber-handle" style="cursor: move; height: 16.6667%;">
                                <div class="Scrubber-bar"></div>
                                <div class="Scrubber-info">
                                  <strong>
                                    <span class="Scrubber-index">1</span>of
                                    <span class="Scrubber-count">10</span>楼</strong>
                                  <span class="Scrubber-description">April 2016</span></div>
                              </div>
                              <div class="Scrubber-after" style="height: 83.3333%;"></div>
                              <div class="Scrubber-unread" style="top: 100%; height: 0%;">unread</div></div>
                            <a class="Scrubber-last">
                              <i class="icon fa fa-fw fa-angle-double-down "></i>最后回复</a>
                          </div>
                        </div>
                      </div>
                    </li>
                  </ul>
                </nav>
                <div class="DiscussionPage-stream">
                  <div class="PostStream">
                    <div class="PostStream-item" data-index="0" data-time="2016-04-27T00:34:10.000Z" data-number="1" data-id="23077" data-type="comment" style="display: block;">
                      <article class="Post undefined CommentPost Post--edited">
                        <div>
                          <div class="Post-tags">
                            <span class="TagsLabel ">
                              <a class="TagLabel  colored" title="基于 Flarum 轻论坛的中文增强发行版，集成了一些比较实用的插件，使其更符合国内场景" href="/t/flarumone" style="color: rgb(239, 86, 79); background-color: rgb(239, 86, 79);">
                                <span class="TagLabel-text">FlarumOne</span></a>
                              <a class="TagLabel  colored" title="" href="/t/help" style="color: rgb(96, 176, 173); background-color: rgb(96, 176, 173);">
                                <span class="TagLabel-text">求助</span></a>
                              <a class="TagLabel  colored" title="" href="/t/fix" style="color: rgb(155, 193, 102); background-color: rgb(155, 193, 102);">
                                <span class="TagLabel-text">已解决</span></a>
                              <a class="TagLabel  colored" title="锁帖" href="/t/closed" style="color: rgb(170, 171, 140); background-color: rgb(170, 171, 140);">
                                <span class="TagLabel-text">已归档</span></a>
                            </span>
                          </div>
                          <header class="Post-header">
                            <ul>
                              <li class="item-user">
                                <div class="PostUser">
                                  <h3>
                                    <a href="/user/{{post.author_username}}">
                                      {%if post.author_avatar%}
        <img class="Avatar PostUser-avatar" src="{{post.author_avatar}}"></a>
        {%else%}
        <span class="Avatar PostUser-avatar" style="background: rgb(208, 160, 229);">{{post.author_username|format_username}}</span>
        {%endif%}
                                      <span class="username">{{post.author_username}}</span></a>
                                  </h3>
                                  <ul class="PostUser-badges badges"></ul>
                                </div>
                              </li>
                              <li class="item-meta">
                                <div class="Dropdown PostMeta">
                                  <a class="Dropdown-toggle" data-toggle="dropdown">
                                    <time pubdate="true" datetime="2016-04-27T08:34:10+08:00" title="Wednesday, April 27, 2016 8:34 AM" data-humantime="true">{{post.created|pretty_date}}</time></a>
                                  <div class="Dropdown-menu dropdown-menu">
                                    <span class="PostMeta-number">Post #1</span>
                                    <span class="PostMeta-time">
                                      <time pubdate="true" datetime="2016-04-27T08:34:10+08:00">Wednesday, April 27, 2016 8:34 AM</time></span>
                                    <span class="PostMeta-ip"></span>
                                    <input class="FormControl PostMeta-permalink"></div>
                                </div>
                              </li>
                              <li class="item-edited">
                                <span class="PostEdited" title="" data-original-title="tenten8401 edited 2 Aug">编辑</span></li>
                            </ul>
                          </header>
                          <div class="Post-title">
                            <h2 class="DiscussionHero-title">{{post.title}}</h2></div>
                          <div class="Post-body">
                            {{post.content}}
                          </div>
                          <aside class="Post-actions">
                            <ul>
                              <li class="item-like">
                                <button class="Button Button--link" type="button" title="赞">
                                  <span class="Button-label">赞</span></button>
                              </li>
                              <li class="item-reply">
                                <button class="Button Button--link" type="button" title="回复">
                                  <span class="Button-label">回复</span></button>
                              </li>
                              <li>
                                <div class="ButtonGroup Dropdown dropdown Post-controls itemCount1">
                                  <button class="Dropdown-toggle Button Button--icon Button--flat" data-toggle="dropdown">
                                    <i class="icon fa fa-fw fa-ellipsis-h Button-icon"></i>
                                    <span class="Button-label"></span>
                                    <i class="icon fa fa-fw fa-caret-down Button-caret"></i>
                                  </button>
                                  <ul class="Dropdown-menu dropdown-menu Dropdown-menu--right">
                                    <li class="item-flag">
                                      <button class=" hasIcon" type="button" title="举报">
                                        <i class="icon fa fa-fw fa-flag Button-icon"></i>
                                        <span class="Button-label">举报</span></button>
                                    </li>
                                  </ul>
                                </div>
                              </li>
                            </ul>
                          </aside>
                          <footer class="Post-footer">
                            <ul>
                              <li class="item-liked">
                                <div class="Post-likedBy">
                                  <i class="icon fa fa-fw fa-thumbs-o-up "></i>
                                  <a href="/u/CaptDarkStar">
                                    <span class="username">CaptDarkStar</span></a>,
                                  <a href="/u/datitisev">
                                    <span class="username">datitisev</span></a>, and
                                  <a href="/u/Juchem">
                                    <span class="username">Juchem</span></a>like this.</div>
                              </li>
                            </ul>
                          </footer>
                        </div>
                      </article>
                      <div class="Post-quoteButtonContainer"></div>
                    </div>

                    

                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>
                    <div class="PostStream-item" data-index="2555"><div class="Post CommentPost LoadingPost"><header class="Post-header"><span class="Avatar PostUser-avatar"></span><div class="fakeText"></div></header><div class="Post-body"><div class="fakeText"></div><div class="fakeText"></div><div class="fakeText"></div></div></div></div>

                    <div class="PostStream-item">
                      <article class="Post ReplyPlaceholder">
                        <header class="Post-header">
                          <span class="Avatar PostUser-avatar" style="background: rgb(160, 176, 229);">{{user_info.username|format_username}}</span>回复一发...</header></article>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="flarum-loading" style="display: none;">Loading...</div>
        <div class="App-composer">
      <div class="container">
        <div id="composer"><div class="Composer" style="display: none; bottom: 0px; height: 300px;"><div class="Composer-handle" style="cursor: row-resize;"></div><ul class="Composer-controls"><li class="item-minimize App-backControl"><button title="Minimize" itemclassname="App-backControl" class="Button Button--icon Button--link hasIcon" type="button"><i class="icon fa fa-fw fa-minus minimize Button-icon"></i></button></li><li class="item-fullScreen"><button title="Full Screen" class="Button Button--icon Button--link hasIcon" type="button"><i class="icon fa fa-fw fa-expand Button-icon"></i></button></li><li class="item-close"><button title="Close" class="Button Button--icon Button--link hasIcon" type="button"><i class="icon fa fa-fw fa-times Button-icon"></i></button></li></ul><div class="Composer-content"><div class="ComposerBody "><span class="Avatar ComposerBody-avatar" style="background: rgb(160, 176, 229);">{{user_info.username|format_username}}</span><div class="ComposerBody-content"><ul class="ComposerBody-header"><li class="item-title"><h3><i class="icon fa fa-fw fa-reply "></i>  <a href="/post/{{post.id}}">{{post.title}}</a></h3></li></ul><div class="ComposerBody-editor"><div class="TextEditor"><div class="ComposerBody-emojiWrapper"><div class="ComposerBody-mentionsWrapper"><textarea class="FormControl Composer-flexible" placeholder="回复一发..." style="height: 192px;"></textarea><div class="ComposerBody-mentionsDropdownContainer"></div></div><div class="ComposerBody-emojiDropdownContainer"></div></div><ul class="TextEditor-controls Composer-footer"><li class="item-submit App-primaryControl"><button class="Button Button--primary hasIcon" itemclassname="App-primaryControl" type="button" title="Post Reply"><i class="icon fa fa-fw fa-check Button-icon"></i><span class="Button-label">回复</span></button></li><li class="item-preview"><button class="Button Button--icon hasIcon" type="button"><i class="icon fa fa-fw fa-eye Button-icon"></i></button></li></ul></div></div></div><div class="LoadingIndicator ComposerBody-loading"><div class="spinner" style="position: absolute; width: 0px; z-index: auto; left: 50%; top: 50%;" role="progressbar"><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-0-8 1s linear infinite;"><div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(0deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-1-8 1s linear infinite;"><div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(45deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-2-8 1s linear infinite;"><div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(90deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-3-8 1s linear infinite;"><div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(135deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-4-8 1s linear infinite;"><div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(180deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-5-8 1s linear infinite;"><div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(225deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-6-8 1s linear infinite;"><div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(270deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div></div><div style="position: absolute; top: -1px; opacity: 0.25; animation: opacity-100-25-7-8 1s linear infinite;"><div style="position: absolute; width: 7px; height: 3px; box-shadow: rgba(0, 0, 0, 0.0980392) 0px 0px 1px; transform-origin: left center 0px; transform: rotate(315deg) translate(5px, 0px); border-radius: 1px; background: rgb(102, 125, 153);"></div></div></div>&nbsp;</div></div></div></div></div>
      </div>
    </div>
      </main>
{% endblock %}

{% block modal %}
    <div id="modal"><div class="ModalManager modal fade" style=""></div></div>
{% endblock %}

{% block javascript %}
<script type="text/javascript">
$(document).ready(function() {
  $(document).on('click', '.item-flag', function() {
    var modal = '<div class="Modal modal-dialog FlagPostModal Modal--small"><div class="Modal-content"><div class="Modal-close App-backControl"><button class="Button Button--icon Button--link hasIcon" type="button"><i class="icon fa fa-fw fa-times Button-icon"></i></button></div><form><div class="Modal-header"><h3 class="App-titleControl App-titleControl--text">Flag Post</h3></div><div class="Modal-alert"></div><div class="Modal-body"><div class="Form Form--centered"><div class="Form-group"><div><label class="checkbox"><input type="radio" name="reason" value="off_topic"><strong>Off-topic</strong>This post is not relevant to the current discussion and should be moved elsewhere.</label><label class="checkbox"><input type="radio" name="reason" value="inappropriate"><strong>Inappropriate</strong>This post is offensive, abusive, or violates our <a>community guidelines</a>.</label><label class="checkbox"><input type="radio" name="reason" value="spam"><strong>Spam</strong>This post is an advertisement.</label><label class="checkbox"><input type="radio" name="reason" value="other"><strong>Other</strong></label></div></div><div class="Form-group"><button class="Button Button--primary Button--block disabled" type="submit" disabled="" title="Flag Post"><span class="Button-label">Flag Post</span></button></div></div></div></form></div></div>';
    $('.ModalManager').html(modal);
    $('.modal').modal('show');
  });

  $(document).on('click', '.item-controls', function() {
    $('.Composer').addClass('normal'); 
    $('.Composer').addClass('visible');
    $('.Composer').css("display", "block");
  });

  $(document).on('click', '.ReplyPlaceholder', function() {
    $('.Composer').addClass('normal'); 
    $('.Composer').addClass('visible');
    $('.Composer').css("display", "block");
  });
  $(document).on('click', '.item-submit', function() {
    $('.ComposerBody-loading').addClass('active');
    var content = $('.Composer-flexible').val();
    $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            url: "/reply/{{post.id}}",
            data: JSON.stringify({
                content: content,
            }),
            success: function(msg) {
                if (msg.success == 1) {
                    $('.ComposerBody-loading').removeClass('active');
                    $('.Composer-flexible').val("");
                    $('.Composer').removeClass('normal'); 
                    $('.Composer').removeClass('active');
                    $('.Composer').removeClass('visible');
                    $('.Composer').css("display", "none");
                }
            },
            error: function(msg) {
                alert("error");
            }
        });
  });
  
  
});
</script>
{% endblock %}